<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Masoveria del Bosc</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root { --primary: #3d5a40; --bg: #fdfcf8; --white: #ffffff; }
    body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; }
    
    /* Tareas con lógica de tu proyecto anterior */
    .card-custom { 
      background: white; border-radius: 12px; padding: 15px; margin: 10px;
      display: flex; align-items: center; transition: all 0.4s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .task-done { text-decoration: line-through; opacity: 0.5; transform: translateX(20px); }
    
    .btn-check { 
      width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 50%; 
      margin-right: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center;
    }
    .btn-check.active { background: #27ae60; border-color: #27ae60; color: white; }

    /* Nav Inferior */
    .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: white; display: flex; border-top: 1px solid #eee; }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; font-size: 12px; }
    .nav-item.active { color: var(--primary); }
    
    .section { display: none; padding: 15px; }
    .section.active { display: block; }
    
    #loader { position: fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:1000; display:flex; justify-content:center; align-items:center; }
  </style>
</head>
<body>

<div id="loader">Cargando Masoveria...</div>

<div id="sec-tareas" class="section active">
  <h2 style="color:var(--primary)">Tareas Diarias</h2>
  <div id="lista-diarias"></div>
  <h2 style="color:var(--primary); margin-top:30px">Generales</h2>
  <div id="lista-generales"></div>
</div>

<nav class="bottom-nav">
  <div class="nav-item active" onclick="showSec('sec-tareas')"><i class="bi bi-list-check"></i>Tareas</div>
  <div class="nav-item" onclick="showSec('sec-calendario')"><i class="bi bi-calendar"></i>Cal</div>
  <div class="nav-item" onclick="showSec('sec-compras')"><i class="bi bi-cart"></i>Market</div>
</nav>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxBK0kLLRFuhectkf2qLbGh8jxggXB5c1C1IyYJYN_CCQ86u-_DnqX7f63ddUIkv0s/exec";
  let appData = {};

  async function cargarTodo() {
    const res = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({action: 'obtenerTodo'})
    });
    const json = await res.json();
    appData = json.data;
    renderTareas();
    document.getElementById('loader').style.display = 'none';
  }

  function renderTareas() {
    const contenedor = document.getElementById('lista-generales');
    contenedor.innerHTML = appData.tareasGenerales.map(t => `
      <div class="card-custom" id="task-${t[0]}">
        <div class="btn-check" onclick="marcarHecho('${t[0]}', this)"></div>
        <div>
          <strong>${t[1]}</strong><br>
          <small>${t[3]} - Prioridad: ${t[4]}</small>
        </div>
      </div>
    `).join('');

    document.getElementById('lista-diarias').innerHTML = appData.tareasDiarias.map(t => `
      <div class="card-custom">
        <div class="btn-check active"></div>
        <span><b>${t[2]}:</b> ${t[1]}</span>
      </div>
    `).join('');
  }

  // LÓGICA DE TU PROYECTO ANTERIOR ADAPTADA
  async function marcarHecho(nombre, btn) {
    const card = btn.closest('.card-custom');
    btn.classList.add('active');
    card.classList.add('task-done');
    
    // Llamada al servidor (reemplaza google.script.run)
    const res = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({action: 'completarTarea', nombreTarea: nombre})
    });

    setTimeout(() => {
      card.style.opacity = '0';
      setTimeout(() => card.style.display = 'none', 400);
    }, 1500);
  }

  function showSec(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  window.onload = cargarTodo;
</script>
</body>
</html>
